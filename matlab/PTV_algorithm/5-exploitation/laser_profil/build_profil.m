% INPUTs:
% set = a set of images
% data_mask = data to build a rectangular mask
% data = data used to perform the detection of particles
%
% For each image of the set, this function detects the particles light by
% the laser line which are under the mask
%
% OUTPUT
% result = a structure containing, for each image of the set, the array of
% all the detetected particles under the mask

function [result,result2] = build_profil(set, data_mask, data, theta)

for i=1:set.Count
    
    array = detect_particles(set, i, data, 0);
    part_in_mask = check_rectangular_mask(data_mask,array);
    array_proj = [part_in_mask(:,1),cos(theta)*part_in_mask(:,2)];
    name = ['pict_', num2str(i)];
    result.(name) = array_proj;
    result2.(name) = part_in_mask;
      
end

end