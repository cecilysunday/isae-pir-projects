% This function creates a GIF from data profil. The GIF is in data\GIF
%
% INPUTs:
% set: a set of images
% data_profil: output of the function build_profil 
% data_mask: data used to create a rectangulat mask
% my_name: the name of the GIF you want to create
% step: the step between 2 successives frames of the GIF
% theta = angle of projection (angle of the camera)
% pixel_scale
% zero = the value (in pixel) corresponding to height = 0. This value is
% used to shift the y-axis
%
% OUTPUT:
% A GIF in data\GIF

function get_GIF(my_set, data_profil, data_mask ,my_name, step, theta, pixel_scale, zero)

%Bead diameter (mm)
b_d = 4;

h = figure;
filename = strcat('matlab\data\GIF\',my_name,'.gif');

for i = 1:step:my_set.Count
    
    name = ['pict_', num2str(i)];
    array = data_profil.(name);
    x = array(:,1);
    y = array(:,2);
    plot(x,y);
    
    xlim([0/b_d 95/b_d]);
    ylim([-data_mask(1,2)-data_mask(1,4)+zero, -data_mask(1,2)+zero]*(cos(theta)/pixel_scale));
    xlabel('bead diameter'); 
    ylabel('height of the surface (mm)');
    set(gca,'DataAspectRatio',[1,2,1]);
 
    title({'Radial profile by laser' ['frame ' num2str(i)]});
    frame = getframe(h);
    im = frame2im(frame); 
    [imind,cm] = rgb2ind(im,256); 
    
    % Write to the GIF File 
    if i == 1 
        imwrite(imind,cm,filename,'gif', 'Loopcount',inf); 
    else 
        imwrite(imind,cm,filename,'gif','WriteMode','append'); 
    end
    
end
close(h);
end